<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æŠ½å–å‘½é‹å¡</title>
    <link rel="stylesheet" href="../css/main.css" />
    <style>
      :root {
        --render-scale: 0.45;
      }
      body {
        background: var(--color-bg-blue);
      }
      .scene {
        visibility: hidden;
      }
    </style>
  </head>
  <body class="layout-center">
    <button class="btn btn-secondary btn-group" id="drawBtn">
      ğŸ”® æŠ½å–å‘½é‹å¡
    </button>

    <div class="scene" id="fate-scene">
      <div class="card-wrapper">
        <div class="card" id="fate-card">
          <div class="card-face card-front fate-card" id="fate-data"></div>
        </div>
      </div>
    </div>

    <script type="module">
      import { loadDestinyCards } from "../js/data-loader.js";
      import { renderFateCardContent } from "../js/card-renderer.js";
      import {
        getRandomItem,
        triggerAnimation,
        showError,
      } from "../js/utils.js";

      let deck = [];

      async function init() {
        try {
          deck = await loadDestinyCards();
          document
            .getElementById("drawBtn")
            .addEventListener("click", drawFate);
        } catch (err) {
          showError("ç„¡æ³•è¼‰å…¥å‘½é‹å¡è³‡æ–™");
        }
      }

      function drawFate() {
        if (deck.length === 0) return;

        const card = getRandomItem(deck);

        const scene = document.getElementById("fate-scene");
        const container = document.getElementById("fate-data");
        const cardEl = document.getElementById("fate-card");

        container.innerHTML = renderFateCardContent(card);
        scene.style.visibility = "visible";
        triggerAnimation(cardEl, "drawing");
      }

      init();
    </script>
  </body>
</html>
