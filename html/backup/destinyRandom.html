<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Fate Draw - Tao Fish Game</title>
    <style>
        :root {
            --card-w: 825px;
            --card-h: 1125px;
            --render-scale: 0.45; 
        }

        * { box-sizing: border-box; }
        body { 
            background: #2c3e50; 
            color: #ecf0f1; 
            font-family: 'Noto Sans TC', sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .draw-btn {
            padding: 18px 50px;
            font-size: 26px;
            font-weight: bold;
            background: #e67e22;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(230, 126, 34, 0.4);
            transition: all 0.2s;
            margin-bottom: 50px;
            z-index: 100;
        }

        .draw-btn:hover { background: #d35400; transform: scale(1.05); }
        .draw-btn:active { transform: scale(0.95); }

        /* å¡ç‰Œå±•ç¤ºå€ */
        .scene {
            width: calc(var(--card-w) * var(--render-scale));
            height: calc(var(--card-h) * var(--render-scale));
            perspective: 2000px;
            visibility: hidden;
        }

        .card-wrapper {
            width: var(--card-w);
            height: var(--card-h);
            transform: scale(var(--render-scale));
            transform-origin: top left;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
        }

        /* æŠ½ç‰Œå‹•ç•« */
        .drawing { animation: cardPop 0.6s ease-out forwards; }
        @keyframes cardPop {
            0% { transform: translateY(200px) scale(0.8) rotateX(-30deg); opacity: 0; }
            100% { transform: translateY(0) scale(1) rotateX(0); opacity: 1; }
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 50px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border: 10px solid #34495e;
            display: flex;
            flex-direction: column;
            padding: 60px;
        }

        /* æ­£é¢ï¼šç™½åº•é»‘å­— */
        .card-front {
            background: #ffffff;
            color: #2c3e50;
            text-align: center;
            justify-content: space-between;
        }

        /* èƒŒé¢ï¼šæŒ‡å®šæ¨¡ç‰ˆ */
        .card-back {
            background-image: url('template_back_v1.png');
            background-size: 100% 100%;
            /* é è¨­é¡¯ç¤ºèƒŒé¢ï¼ŒæŠ½ä¸­å¾Œå†ç¿»è½‰æˆ–ç›´æ¥é¡¯ç¤ºæ­£é¢ */
        }

        /* å…§éƒ¨å…§å®¹ */
        .fate-title { font-size: 85px; font-weight: 900; color: #e67e22; border-bottom: 6px solid #f39c12; padding-bottom: 20px; }
        .fate-content { font-size: 55px; line-height: 1.4; flex-grow: 1; display: flex; align-items: center; justify-content: center; }
        .fate-result { font-size: 48px; font-weight: bold; background: #fdf2e9; padding: 35px; border-radius: 30px; color: #c0392b; border: 3px dashed #e67e22; }

    </style>
</head>
<body>

    <button class="draw-btn" onclick="drawFate()">ğŸ”® æŠ½å–å‘½é‹å¡</button>

    <div class="scene" id="fate-scene">
        <div class="card-wrapper">
            <div class="card" id="fate-card">
                <div class="card-face card-front" id="fate-data">
                    </div>
            </div>
        </div>
    </div>

    <script>
        let deck = [];

        // è¼‰å…¥ JSON è³‡æ–™
        async function init() {
            try {
                const response = await fetch('destiny.json');
                deck = await response.json();
            } catch (err) {
                console.error("ç„¡æ³•è®€å– destiny.json", err);
            }
        }

        function drawFate() {
            if (deck.length === 0) return;

            // 1. éš¨æ©Ÿé¸å–
            const card = deck[Math.floor(Math.random() * deck.length)];
            
            // 2. æ³¨å…¥å…§å®¹
            const container = document.getElementById('fate-data');
            container.innerHTML = `
                <div class="fate-title">${card.title}</div>
                <div class="fate-content">${card.content}</div>
                <div class="fate-result">çµæœï¼š<br>${card.result}</div>
            `;

            // 3. è§¸ç™¼å‹•ç•«æ•ˆæœ
            const scene = document.getElementById('fate-scene');
            const cardEl = document.getElementById('fate-card');
            
            scene.style.visibility = 'visible';
            cardEl.classList.remove('drawing');
            void cardEl.offsetWidth; // å¼·åˆ¶é‡ç¹ªè§¸ç™¼å‹•ç•«
            cardEl.classList.add('drawing');
        }

        init();
    </script>
</body>
</html>